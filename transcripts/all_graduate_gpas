-- This pulls all Cumulative GPAs for all graduates of SPS schools. Filter in the WHERE to select a calculation. Run GPA Rankings for a grade level/year/calculation if GPAs don't appear that you expect.

SELECT ssa.site_id, ssa.grade_level_id,
  stu.local_student_id,
  stu.last_name,
  stu.first_name,
  stu.graduation_status,
  stu.graduation_date,
  stu.graduation_requirement_year,
  g.gpa,
  gc.gpa_calculation_name

FROM
  matviews.ss_any ssa

LEFT JOIN students stu on ssa.student_id = stu.student_id
LEFT JOIN student_gpa g on stu.student_id = g.student_id
LEFT JOIN gpa_calculations gc ON g.gpa_calculation_id = gc.gpa_calculation_id

WHERE
  ssa.site_id NOT IN (9999998,9999999)
-- Filter for Seniors
  AND ssa.grade_level_id = '13'
-- Filter to only capture Cumulative GPA
  AND g.academic_year IS NULL
-- Filter for students who graduated
  AND stu.graduation_status IN (1,2,10,11)
-- GPA Calculations Filter Here:
  -- 1,"GPA 9-12, Unweighted"
  -- 2,UC/CSU GPA
  -- 3,"GPA 9-12, Weighted"
  -- 5,CalGrant
  -- 6,"GPA 10-12, Weighted"
  AND g.gpa_calculation_id = 1


ORDER BY ssa.student_id
